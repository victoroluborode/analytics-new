<div class="dashboard-bg">
    <div class="analytics-container">
        <div class="top-filters">
            <div class="filter-row-left">
                <div class="filter">
                    <label>Date Range</label>
                    <select [(ngModel)]="selectedDateRange" (change)="onFilterChange()">
                        @for (option of dateRangeOptions; track option.value) {
                        <option [value]="option.value">
                            {{ option.label }}
                        </option>
                        }
                    </select>
                </div>
            </div>
            <div class="filter-row-right">
                <div class="filter">
                    <label>Specific Date</label>
                    <input type="date" [(ngModel)]="selectedDate" (change)="onDateChange()" class="date-input" />
                </div>
            </div>
            <button (click)="exportToExcel()" class="export-button">
                Download Report (Excel)
            </button>
        </div>
        <div class="metrics-row">
            <div class="metric-card">
                <div class="metric-title">Revenue Growth Rate (MoM)</div>
                <div class="metric-value">
                    @if (getRevenueGrowthRate('month') !== null) {
                    {{ getRevenueGrowthRate('month') }}%
                    } @else {
                    N/A
                    }
                </div>
                <div class="metric-date-range">This Month vs Previous Month</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Revenue Growth Rate (YoY)</div>
                <div class="metric-value">
                    @if (getRevenueGrowthRate('year') !== null) {
                    {{ getRevenueGrowthRate('year') }}%
                    } @else {
                    N/A
                    }
                </div>
                <div class="metric-date-range">This Year vs Previous Year</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Total Revenue</div>
                <div class="metric-value">₦{{ getTotalRevenue() | number:'1.0-2' }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Total Orders</div>
                <div class="metric-value">{{ getTotalOrders() }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Average Order Value</div>
                <div class="metric-value">₦{{ getAverageOrderValue() | number:'1.0-2' }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Order Completion Rate</div>
                <div class="metric-value">{{ getOrderCompletionRate() }}%</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            @if (!useSpecificDate) {
            <div class="metric-card">
                <div class="metric-title">Busiest Day</div>
                <div class="metric-value">{{ getBusiestDay() || 'N/A' }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            }
            <div class="metric-card">
                <div class="metric-title">Busiest Hour</div>
                <div class="metric-value">{{ getBusiestHour() || 'N/A' }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Total Unique Customers</div>
                <div class="metric-value">{{ getTotalUniqueCustomers() }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Delivery vs Pickup</div>
                <div style="display: flex; gap: 1rem; margin-top: 0.5rem; justify-content: space-around;">
                    <div style="text-align: center;">
                        <div style="font-size: 0.7rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500;">
                            Delivery</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #111827;">{{
                            getDeliveryPickupSplit().delivery }}%</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 0.7rem; color: #6b7280; margin-bottom: 0.25rem; font-weight: 500;">Pickup
                        </div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #111827;">{{
                            getDeliveryPickupSplit().pickup }}%</div>
                    </div>
                </div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Pending Orders</div>
                <div class="metric-value">{{ getPendingOrders() }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">Completed Orders</div>
                <div class="metric-value">{{ getCompletedOrders() }}</div>
                <div class="metric-date-range">{{ getDateRangeLabel() }}</div>
            </div>
        </div>
        <div class="main-chart-card">
            <h3>Revenue Over Time</h3>
            <div echarts [options]="revenueOverTimeChartOption" class="main-chart"></div>
        </div>
        <div class="charts-grid">
            <div class="chart-card">
                <h3>Revenue by Delivery Method</h3>
                <div echarts [options]="deliveryMethodChartOption" class="secondary-chart"></div>
            </div>
            <div class="chart-card">
                <h3>Orders Per Hour</h3>
                <div echarts [options]="ordersPerHourChartOption" class="secondary-chart"></div>
            </div>
            <div class="chart-card">
                <h3>Top 10 Customers</h3>
                <div echarts [options]="topCustomersChartOption" class="secondary-chart"></div>
            </div>
            @if (!useSpecificDate) {
            <div class="chart-card">
                <h3>Orders by Day of Week</h3>
                <div echarts [options]="ordersByDayChartOption" class="secondary-chart"></div>
            </div>
            }
            <div class="chart-card">
                <h3>Orders by Time of Day</h3>
                <div echarts [options]="ordersByTimeOfDayChartOption" classs="secondary-chart"></div>
            </div>
        </div>
    </div>
</div>